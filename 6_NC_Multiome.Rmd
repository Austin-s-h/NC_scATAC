---
title: "NC Multiome"
output: html_notebook
---

# NC Multiome

## Setup

```{r}
library(renv)
renv::activate()
# install.packages("BSgenome.Ggallus.ENSEMBL.galGal6_1.0.3.tar.gz", repos = NULL)
```


```{r}
suppressPackageStartupMessages({
  library(ArchR)
  library(BSgenome.Ggallus.ENSEMBL.galGal6)
  library(GenomicFeatures)
  library(RMariaDB)
  library(org.Gg.eg.db)
})

addArchRThreads(threads = 48) 
set.seed(1)
# Make a blacklist for AADN05001427.1
arch_gg6 <- createGenomeAnnotation(genome = BSgenome.Ggallus.ENSEMBL.galGal6, filter = F)
# Manually remove noncontigous chromosomes.
arch_gg6$chromSizes <- arch_gg6$chromSizes[1:35]
TxDb_galGal6 <- makeTxDbFromEnsembl(organism = "Gallus gallus", release = 106)
OrgDb <- org.Gg.eg.db
# arch_gg6_genes <- createGeneAnnotation(TxDb = TxDb_galGal6, OrgDb = OrgDb, annoStyle = "ENSEMBL")
arch_gg6_anno <- createGenomeAnnotation(genome = BSgenome.Ggallus.ENSEMBL.galGal6, filterChr = "MT")
```

```{r}
#Get Input Fragment Files
inputFiles <- getInputFiles(paths=c("/workspaces/NC_scATAC/NC_Multiome/outs/filtered_feature_bc_matrix"))
names(inputFiles) <- "NC_Multiome"

#Create Arrow Files (disabled here)
ArrowFiles <- "PBMC_10k.arrow" #createArrowFiles(inputFiles, force = TRUE)

#ArchRProject
proj <- ArchRProject(ArrowFiles)
```


```{r}
# TODO we should copy this to a local directory
# projNC <- loadArchRProject(path = "/data/Austin/10XscATAC/ArchR_data_final_thesis/")
# projNC@projectMetadata$outputDirectory <- "./Figure_Exports"
# projNC <- addImputeWeights(projNC, sampleCells = 10000, nRep = 3, k = 20)
# cluster_to_identity <- data.frame(cluster = paste0("C",1:10),
#                                   identity = c("C1_Melanocytes","C2_Sensory_Glia","C3_Int_Mesenchyme",
#                                                "C4_Multipotent_NC","C5_Hindbrain_Neurons","C6_Somatosensory_Neurons",
#                                                "C7_Midbrain_Neurons","C8_Early_Mesenchyme","C9_Sensory_Neurons",
#                                                "C10_Late_Mesenchyme"))
# projNC$Cell_Identity <- lookup(projNC$Clusters, cluster_to_identity)
```